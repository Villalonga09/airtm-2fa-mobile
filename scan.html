<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
  <meta name="theme-color" content="#4a9eff">
  <title>Agregar Cuenta 2FA - Airtm</title>
  <link rel="stylesheet" href="scan.css">
</head>
<body>
  <div class="container">
    <!-- Header -->
    <header class="header">
      <div class="header-content">
        <div class="logo">
          <span class="logo-icon">🔐</span>
          <div class="logo-text">
            <span class="brand">Airtm</span>
            <span class="brand-sub">2FA</span>
          </div>
        </div>
        <div class="header-title">Agregar Cuenta</div>
      </div>
    </header>

    <!-- Main Content -->
    <main class="main-content">
      <!-- Loading State -->
      <div id="loadingState" class="state-container">
        <div class="loader"></div>
        <p class="state-text">Verificando sesión...</p>
      </div>

      <!-- Error State -->
      <div id="errorState" class="state-container hidden">
        <div class="error-icon">❌</div>
        <h2 class="error-title">Sesión Inválida</h2>
        <p class="error-text">El código QR ha expirado o no es válido. Por favor, genera uno nuevo desde la extensión.</p>
        <button id="retryBtn" class="btn btn-secondary">Reintentar</button>
      </div>

      <!-- Form State -->
      <div id="formState" class="state-container hidden">
        <div class="form-header">
          <div class="form-icon">📱</div>
          <h2 class="form-title">Escanear Código QR</h2>
          <p class="form-subtitle">Apunta tu cámara al código QR TOTP</p>
        </div>

        <!-- QR Scanner Section -->
        <div class="scanner-section">
          <button type="button" id="scanQRBtn" class="btn btn-primary btn-large">
            <span class="btn-icon">📷</span>
            Activar Cámara
          </button>
          <p class="scanner-hint">La cuenta se agregará automáticamente al escanear</p>
        </div>
      </div>

      <!-- Success State -->
      <div id="successState" class="state-container hidden">
        <div class="success-animation">
          <div class="success-icon">✓</div>
        </div>
        <h2 class="success-title">¡Cuenta Agregada!</h2>
        <p class="success-text">La cuenta se ha agregado correctamente a tu extensión. Puedes cerrar esta ventana.</p>
        <button id="closeBtn" class="btn btn-primary">Cerrar</button>
      </div>
    </main>

    <!-- Footer -->
    <footer class="footer">
      <p class="footer-text">
        <span class="footer-icon">🔒</span>
        Conexión segura
      </p>
    </footer>
  </div>

  <!-- Camera View (Full Screen) - Estilo WhatsApp -->
  <div id="cameraView" class="camera-view hidden">
    <div class="camera-header">
      <button type="button" id="closeCameraBtn" class="btn-close-camera">
        Cancelar
      </button>
      <h3 class="camera-title">Escanea el código QR</h3>
    </div>
    <div class="camera-instructions">
      <p class="camera-instructions-text">Abre web.whatsapp.com, la aplicación de escritorio u otros dispositivos.</p>
    </div>
    <div class="camera-container">
      <div id="qrReader"></div>
    </div>
    <div class="camera-footer">
      <button type="button" class="btn-camera-action">
        Vincular con el número de teléfono
      </button>
    </div>
  </div>

  <!-- QR Scanner Library -->
  <script src="https://unpkg.com/html5-qrcode@2.3.8/html5-qrcode.min.js"></script>
  <script type="module" src="scan.js"></script>
</body>
</html>
